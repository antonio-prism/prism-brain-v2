<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PRISM Brain — Risk Intelligence Dashboard</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
:root{--bg:#f8fafc;--card:#fff;--border:#e2e8f0;--text:#1e293b;--muted:#64748b;--light:#94a3b8;--blue:#3b82f6;--green:#22c55e;--red:#ef4444;--orange:#f97316;--yellow:#eab308;--purple:#8b5cf6;--teal:#14b8a6}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text)}
.header{background:linear-gradient(135deg,#1e293b,#0f172a);color:#fff;padding:16px 24px;display:flex;justify-content:space-between;align-items:center}
.header h1{font-size:22px;font-weight:700;letter-spacing:-0.5px}
.header .sub{color:#94a3b8;font-size:13px;margin-top:2px}
.header .status{text-align:right;font-size:12px;color:#94a3b8}
.header .dot{display:inline-block;width:10px;height:10px;background:#22c55e;border-radius:50%}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.4}}
.tabs{background:#fff;border-bottom:1px solid var(--border);display:flex;gap:0;padding:0 24px}
.tab{padding:12px 20px;font-size:14px;font-weight:500;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;transition:all .2s}
.tab:hover{color:var(--text)}
.tab.active{color:var(--blue);border-color:var(--blue)}
.main{max-width:1200px;margin:0 auto;padding:24px}
.view{display:none}
.view.active{display:block}
.grid{display:grid;gap:16px}
.g2{grid-template-columns:repeat(2,1fr)}
.g3{grid-template-columns:repeat(3,1fr)}
.g4{grid-template-columns:repeat(4,1fr)}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;transition:box-shadow .2s}
.card:hover{box-shadow:0 4px 12px rgba(0,0,0,.08)}
.stat-card{color:#fff;border:none;border-radius:12px;padding:20px}
.stat-card .label{font-size:13px;opacity:.9}
.stat-card .value{font-size:36px;font-weight:700;margin:4px 0}
.stat-card .detail{font-size:12px;opacity:.75}
.chart-box{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:20px;margin-top:16px}
.chart-box h3{font-size:16px;margin-bottom:12px}
table{width:100%;border-collapse:collapse;font-size:13px}
th{text-align:left;padding:10px 12px;border-bottom:2px solid var(--border);color:var(--muted);font-weight:600;cursor:pointer}
td{padding:10px 12px;border-bottom:1px solid var(--border)}
tr:hover{background:#f1f5f9}
.badge{display:inline-block;padding:2px 8px;border-radius:4px;font-size:11px;font-weight:600}
.badge-high{background:#fef2f2;color:#dc2626}
.badge-elevated{background:#fff7ed;color:#ea580c}
.badge-moderate{background:#fefce8;color:#ca8a04}
.badge-low{background:#f0fdf4;color:#16a34a}
.prob-bar{display:inline-block;height:8px;border-radius:4px;margin-right:8px;vertical-align:middle}
.search-bar{display:flex;gap:12px;margin-bottom:16px;align-items:center}
.search-bar input{flex:1;padding:8px 12px;border:1px solid var(--border);border-radius:8px;font-size:14px}
.search-bar select{padding:8px 12px;border:1px solid var(--border);border-radius:8px;font-size:14px}
.cat-card{cursor:pointer;transition:transform .2s}
.cat-card:hover{transform:translateY(-2px)}
.cat-card .cat-name{font-size:15px;font-weight:600;margin-bottom:6px}
.cat-card .cat-stat{font-size:13px;color:var(--muted)}
.back-btn{cursor:pointer;color:var(--blue);font-size:14px;margin-bottom:12px;display:inline-block}
.back-btn:hover{text-decoration:underline}
.sort-arrow{font-size:10px;margin-left:4px}
.source-card .src-name{font-weight:600;font-size:15px;margin-bottom:4px}
.source-card .src-status{font-size:12px}
.source-dot{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:6px}
.top-risk-item{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--border)}
.top-risk-name{font-size:13px;flex:1}
.top-risk-prob{font-weight:600;font-size:14px;margin-left:12px}
#loading{text-align:center;padding:60px;color:var(--muted);font-size:16px}
.footer{text-align:center;padding:20px;color:var(--light);font-size:12px;margin-top:40px}
@media(max-width:768px){.g2,.g3,.g4{grid-template-columns:1fr}.main{padding:12px}}
</style>
</head>
<body>
<div class="header">
  <div>
    <h1>PRISM Brain</h1>
    <div class="sub">Risk Intelligence Dashboard — v3.0.0</div>
  </div>
  <div class="status">
    <div>Last calculation: <span id="hdr-calc">-</span></div>
    <div><span id="hdr-events">0</span> events tracked <span class="dot" style="animation:pulse 2s infinite"></span></div>
  </div>
</div>
<div id="tabs" class="tabs">
  <div class="tab active" data-view="overview">Overview</div>
  <div class="tab" data-view="categories">Categories</div>
  <div class="tab" data-view="events">All Events</div>
  <div class="tab" data-view="sources">Data Sources</div>
</div>
<div id="loading">Loading dashboard data...</div>
<div id="app" class="main" style="display:none">
  <div id="view-overview" class="view active">
    <div id="stat-cards" class="grid g2"></div>
    <div class="chart-box"><h3>Average Risk by Category</h3><canvas id="chart-cat-bar"></canvas></div>
    <div class="grid g2" style="margin-top:16px">
      <div class="card"><h3 style="font-size:16px;margin-bottom:12px">Top 10 Highest Risks</h3><div id="top-risks"></div></div>
      <div><div class="chart-box" style="margin-top:0"><h3>Events by Category</h3><canvas id="chart-pie"></canvas></div></div>
    </div>
    <div class="chart-box" style="margin-top:16px"><h3>Risk Level Distribution</h3><div id="risk-levels"></div></div>
  </div>
  <div id="view-categories" class="view">
    <div id="cat-grid-view"><div id="cat-cards" class="grid g3"></div></div>
    <div id="cat-detail-view" style="display:none">
      <div class="back-btn" onclick="showCatGrid()">&larr; Back to Categories</div>
      <div id="cat-detail-title" style="font-size:20px;font-weight:700;margin-bottom:8px"></div>
      <div id="cat-detail-stats" style="margin-bottom:16px;color:var(--muted);font-size:14px"></div>
      <table id="cat-detail-table">
        <thead><tr><th>Event ID</th><th>Name</th><th>Probability <span id="sort-cat-prob" class="sort-arrow">&#9650;</span></th><th>Risk Level</th><th>Confidence <span id="sort-cat-conf" class="sort-arrow"></span></th></tr></thead>
        <tbody id="cat-detail-tbody"></tbody>
      </table>
    </div>
  </div>
  <div id="view-events" class="view">
    <div class="search-bar">
      <input id="search-input" type="text" placeholder="Search events by ID or name...">
      <select id="filter-cat"><option value="">All Categories</option></select>
      <span id="event-count" style="color:var(--muted);font-size:13px"></span>
    </div>
    <table>
      <thead><tr><th>Event ID <span id="sort-evt-id" class="sort-arrow">&#9650;</span></th><th>Name</th><th>Category</th><th>Probability <span id="sort-evt-prob" class="sort-arrow"></span></th><th>Risk Level</th><th>Confidence <span id="sort-evt-conf" class="sort-arrow"></span></th></tr></thead>
      <tbody id="events-tbody"></tbody>
    </table>
  </div>
  <div id="view-sources" class="view">
    <div id="source-cards" class="grid g3"></div>
  </div>
</div>
<div class="footer">PRISM Brain Risk Intelligence Engine — <span id="footer-ts"></span></div>
<script>
var API = window.location.origin + '/api/v1';
var allProbs = [], allEvents = [], allSources = [];
var namesMap = {};
var chartBar = null, chartPie = null;
var evtSort = {col:'event_id',asc:true};
var catSort = {col:'probability',asc:false};

function riskLevel(p){return p>=0.4?'HIGH':p>=0.25?'ELEVATED':p>=0.10?'MODERATE':'LOW'}
function riskColor(l){return{HIGH:'var(--red)',ELEVATED:'var(--orange)',MODERATE:'var(--yellow)',LOW:'var(--green)'}[l]||'var(--muted)'}
function badgeClass(l){return{HIGH:'badge-high',ELEVATED:'badge-elevated',MODERATE:'badge-moderate',LOW:'badge-low'}[l]||''}
function pct(v){return(v*100).toFixed(1)+'%'}
function probBar(v){var w=Math.max(2,v*100);return '<span class="prob-bar" style="width:'+w+'px;background:'+riskColor(riskLevel(v))+'"></span>'+pct(v)}
function catPrefix(id){var m=id.match(/^([A-Z]+)[-_]/);return m?m[1]:'?'}
function eName(id){return namesMap[id]||id}

async function fetchAll(){
  try{
    document.getElementById('loading').style.display='block';
    document.getElementById('app').style.display='none';

    var r1r2=await Promise.all([
      fetch(API+'/probabilities?limit=500&skip=0').then(function(r){return r.json()}),
      fetch(API+'/probabilities?limit=500&skip=500').then(function(r){return r.json()})
    ]);
    var rawProbs=[].concat(r1r2[0].probabilities||r1r2[0]||[]).concat(r1r2[1].probabilities||r1r2[1]||[]);

    var r3r4=await Promise.all([
      fetch(API+'/events?limit=500&skip=0').then(function(r){return r.json()}),
      fetch(API+'/events?limit=500&skip=500').then(function(r){return r.json()})
    ]);
    var rawEvents=[].concat(r3r4[0].events||r3r4[0]||[]).concat(r3r4[1].events||r3r4[1]||[]);

    var srcRes=await fetch(API+'/data/sources').then(function(r){return r.json()});
    allSources=srcRes.sources||srcRes||[];

    var probMap={};
    for(var i=0;i<rawProbs.length;i++){
      var p=rawProbs[i];
      if(!p.event_id) continue;
      if(!probMap[p.event_id]||new Date(p.calculation_date)>new Date(probMap[p.event_id].calculation_date)){
        probMap[p.event_id]=p;
      }
    }
    allProbs=Object.values(probMap);

    var evtMap={};
    for(var j=0;j<rawEvents.length;j++){
      var e=rawEvents[j];
      if(e.event_id) evtMap[e.event_id]=e;
    }
    allEvents=Object.values(evtMap);

    namesMap={};
    for(var k=0;k<allEvents.length;k++){
      if(allEvents[k].event_name) namesMap[allEvents[k].event_id]=allEvents[k].event_name;
    }
    for(var m=0;m<allProbs.length;m++){
      allProbs[m].event_name=namesMap[allProbs[m].event_id]||allProbs[m].event_id;
      allProbs[m].current_probability=(allProbs[m].probability_pct||0)/100;
    }

    document.getElementById('loading').style.display='none';
    document.getElementById('app').style.display='block';
    renderAll();
  }catch(err){
    console.error('Fetch error:',err);
    document.getElementById('loading').textContent='Error loading data: '+err.message;
  }
}

function renderAll(){
  renderOverview();
  renderCharts();
  renderCategories();
  renderEventsTable();
  renderSources();
  updateHeader();
}

function updateHeader(){
  document.getElementById('hdr-events').textContent=allProbs.length||allEvents.length;
  if(allProbs.length>0&&allProbs[0].calculation_date){
    var d=new Date(allProbs[0].calculation_date);
    document.getElementById('hdr-calc').textContent=d.toLocaleDateString()+' '+d.toLocaleTimeString();
  }
  document.getElementById('footer-ts').textContent='Last updated: '+new Date().toLocaleString();
}

function renderOverview(){
  var total=allProbs.length;
  var avgRisk=0;
  for(var i=0;i<allProbs.length;i++) avgRisk+=(allProbs[i].current_probability||0);
  if(total) avgRisk=avgRisk/total;
  var high=0,elevated=0,moderate=0,low=0;
  for(var i=0;i<allProbs.length;i++){
    var v=allProbs[i].current_probability||0;
    if(v>=0.4) high++;
    else if(v>=0.25) elevated++;
    else if(v>=0.10) moderate++;
    else low++;
  }

  document.getElementById('stat-cards').innerHTML=
    '<div class="stat-card" style="background:linear-gradient(135deg,#3b82f6,#2563eb)"><div class="label">Total Events</div><div class="value">'+total+'</div><div class="detail">'+allEvents.length+' in database</div></div>'+
    '<div class="stat-card" style="background:linear-gradient(135deg,#8b5cf6,#7c3aed)"><div class="label">Average Risk</div><div class="value">'+pct(avgRisk)+'</div><div class="detail">Across all events</div></div>'+
    '<div class="stat-card" style="background:linear-gradient(135deg,#ef4444,#dc2626)"><div class="label">High Risk</div><div class="value">'+high+'</div><div class="detail">&gt;40% probability</div></div>'+
    '<div class="stat-card" style="background:linear-gradient(135deg,#f97316,#ea580c)"><div class="label">Elevated</div><div class="value">'+elevated+'</div><div class="detail">25-40% probability</div></div>'+
    '<div class="stat-card" style="background:linear-gradient(135deg,#eab308,#ca8a04)"><div class="label">Moderate</div><div class="value">'+moderate+'</div><div class="detail">10-25% probability</div></div>'+
    '<div class="stat-card" style="background:linear-gradient(135deg,#14b8a6,#0d9488)"><div class="label">Data Sources</div><div class="value">'+allSources.length+'/12</div><div class="detail">Active feeds</div></div>';

  var sorted=allProbs.slice().sort(function(a,b){return(b.current_probability||0)-(a.current_probability||0)});
  var top10=sorted.slice(0,10);
  document.getElementById('top-risks').innerHTML=top10.map(function(p){
    var prob=p.current_probability||0;
    var lvl=riskLevel(prob);
    return '<div class="top-risk-item"><span class="top-risk-name">'+eName(p.event_id)+' <span style="color:var(--muted);font-size:11px">('+p.event_id+')</span></span><span class="badge '+badgeClass(lvl)+'">'+lvl+'</span><span class="top-risk-prob">'+pct(prob)+'</span></div>';
  }).join('');

  document.getElementById('risk-levels').innerHTML=
    '<div class="grid g4" style="text-align:center">'+
    '<div><div style="font-size:28px;font-weight:700;color:var(--red)">'+high+'</div><div style="color:var(--muted);font-size:13px">HIGH</div></div>'+
    '<div><div style="font-size:28px;font-weight:700;color:var(--orange)">'+elevated+'</div><div style="color:var(--muted);font-size:13px">ELEVATED</div></div>'+
    '<div><div style="font-size:28px;font-weight:700;color:var(--yellow)">'+moderate+'</div><div style="color:var(--muted);font-size:13px">MODERATE</div></div>'+
    '<div><div style="font-size:28px;font-weight:700;color:var(--green)">'+low+'</div><div style="color:var(--muted);font-size:13px">LOW</div></div>'+
    '</div>';
}

function renderCharts(){
  var cats={};
  for(var i=0;i<allProbs.length;i++){
    var c=catPrefix(allProbs[i].event_id);
    if(!cats[c]) cats[c]={sum:0,count:0};
    cats[c].sum+=(allProbs[i].current_probability||0);
    cats[c].count++;
  }
  var labels=Object.keys(cats).sort();
  var avgs=labels.map(function(c){return cats[c].count?(cats[c].sum/cats[c].count*100):0});
  var counts=labels.map(function(c){return cats[c].count});

  if(chartBar){chartBar.destroy();chartBar=null}
  if(chartPie){chartPie.destroy();chartPie=null}

  var ctxBar=document.getElementById('chart-cat-bar').getContext('2d');
  chartBar=new Chart(ctxBar,{
    type:'bar',
    data:{labels:labels,datasets:[{label:'Avg Probability %',data:avgs,backgroundColor:'rgba(59,130,246,0.7)',borderRadius:6}]},
    options:{responsive:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,max:100,ticks:{callback:function(v){return v+'%'}}}}}
  });

  var ctxPie=document.getElementById('chart-pie').getContext('2d');
  var colors=['#3b82f6','#8b5cf6','#ef4444','#f97316','#eab308','#22c55e','#14b8a6','#ec4899','#6366f1','#a855f7','#06b6d4','#84cc16'];
  chartPie=new Chart(ctxPie,{
    type:'doughnut',
    data:{labels:labels,datasets:[{data:counts,backgroundColor:colors.slice(0,labels.length)}]},
    options:{responsive:true,plugins:{legend:{position:'right',labels:{font:{size:11}}}}}
  });
}

function renderCategories(){
  var cats={};
  for(var i=0;i<allProbs.length;i++){
    var c=catPrefix(allProbs[i].event_id);
    if(!cats[c]) cats[c]={events:[],sum:0};
    cats[c].events.push(allProbs[i]);
    cats[c].sum+=(allProbs[i].current_probability||0);
  }
  var html='';
  Object.keys(cats).sort().forEach(function(c){
    var avg=cats[c].events.length?(cats[c].sum/cats[c].events.length):0;
    var lvl=riskLevel(avg);
    html+='<div class="card cat-card" onclick="showCatDetail(\''+c+'\')"><div class="cat-name">'+c+'</div><div class="cat-stat">'+cats[c].events.length+' events &bull; Avg: '+pct(avg)+'</div><div style="margin-top:8px"><span class="badge '+badgeClass(lvl)+'">'+lvl+'</span></div></div>';
  });
  document.getElementById('cat-cards').innerHTML=html;
}

function showCatDetail(cat){
  document.getElementById('cat-grid-view').style.display='none';
  document.getElementById('cat-detail-view').style.display='block';
  document.getElementById('cat-detail-title').textContent='Category: '+cat;
  var events=allProbs.filter(function(p){return catPrefix(p.event_id)===cat});
  document.getElementById('cat-detail-stats').textContent=events.length+' events in this category';
  catSort={col:'probability',asc:false};
  renderCatDetailTable(events);
}
function showCatGrid(){
  document.getElementById('cat-grid-view').style.display='block';
  document.getElementById('cat-detail-view').style.display='none';
}
function renderCatDetailTable(events){
  events.sort(function(a,b){
    var va,vb;
    if(catSort.col==='probability'){va=a.current_probability||0;vb=b.current_probability||0}
    else{va=a.confidence_score||0;vb=b.confidence_score||0}
    return catSort.asc?va-vb:vb-va;
  });
  document.getElementById('cat-detail-tbody').innerHTML=events.map(function(p){
    var prob=p.current_probability||0;
    var lvl=riskLevel(prob);
    var conf=p.confidence_score||0;
    return '<tr><td>'+p.event_id+'</td><td>'+eName(p.event_id)+'</td><td>'+probBar(prob)+'</td><td><span class="badge '+badgeClass(lvl)+'">'+lvl+'</span></td><td>'+pct(conf)+'</td></tr>';
  }).join('');
}
function sortCatTable(col){
  if(catSort.col===col) catSort.asc=!catSort.asc; else{catSort.col=col;catSort.asc=col==='probability'?false:true}
  var cat=document.getElementById('cat-detail-title').textContent.replace('Category: ','');
  var events=allProbs.filter(function(p){return catPrefix(p.event_id)===cat});
  renderCatDetailTable(events);
  document.getElementById('sort-cat-prob').textContent=catSort.col==='probability'?(catSort.asc?'\u25B2':'\u25BC'):'';
  document.getElementById('sort-cat-conf').textContent=catSort.col==='confidence'?(catSort.asc?'\u25B2':'\u25BC'):'';
}

function renderEventsTable(){
  var catSet={};
  for(var i=0;i<allProbs.length;i++) catSet[catPrefix(allProbs[i].event_id)]=true;
  var filterEl=document.getElementById('filter-cat');
  filterEl.innerHTML='<option value="">All Categories</option>';
  Object.keys(catSet).sort().forEach(function(c){
    filterEl.innerHTML+='<option value="'+c+'">'+c+'</option>';
  });
  applyEventsFilter();
}

function applyEventsFilter(){
  var search=(document.getElementById('search-input').value||'').toLowerCase();
  var catFilter=document.getElementById('filter-cat').value;
  var filtered=allProbs.filter(function(p){
    if(catFilter&&catPrefix(p.event_id)!==catFilter) return false;
    if(search){
      var name=eName(p.event_id).toLowerCase();
      var id=p.event_id.toLowerCase();
      if(id.indexOf(search)===-1&&name.indexOf(search)===-1) return false;
    }
    return true;
  });

  filtered.sort(function(a,b){
    var va,vb;
    if(evtSort.col==='event_id'){va=a.event_id;vb=b.event_id;return evtSort.asc?va.localeCompare(vb):vb.localeCompare(va)}
    if(evtSort.col==='probability'){va=a.current_probability||0;vb=b.current_probability||0}
    else{va=a.confidence_score||0;vb=b.confidence_score||0}
    return evtSort.asc?va-vb:vb-va;
  });

  document.getElementById('event-count').textContent=filtered.length+' of '+allProbs.length+' events';
  document.getElementById('events-tbody').innerHTML=filtered.map(function(p){
    var prob=p.current_probability||0;
    var lvl=riskLevel(prob);
    var conf=p.confidence_score||0;
    return '<tr><td>'+p.event_id+'</td><td>'+eName(p.event_id)+'</td><td><span class="badge" style="background:#f1f5f9;color:var(--text)">'+catPrefix(p.event_id)+'</span></td><td>'+probBar(prob)+'</td><td><span class="badge '+badgeClass(lvl)+'">'+lvl+'</span></td><td>'+pct(conf)+'</td></tr>';
  }).join('');
}

function sortEvtTable(col){
  if(evtSort.col===col) evtSort.asc=!evtSort.asc; else{evtSort.col=col;evtSort.asc=col==='event_id'}
  applyEventsFilter();
  document.getElementById('sort-evt-id').textContent=evtSort.col==='event_id'?(evtSort.asc?'\u25B2':'\u25BC'):'';
  document.getElementById('sort-evt-prob').textContent=evtSort.col==='probability'?(evtSort.asc?'\u25B2':'\u25BC'):'';
  document.getElementById('sort-evt-conf').textContent=evtSort.col==='confidence'?(evtSort.asc?'\u25B2':'\u25BC'):'';
}

function renderSources(){
  if(!allSources.length){
    document.getElementById('source-cards').innerHTML='<div style="color:var(--muted);padding:20px">No source data available</div>';
    return;
  }
  document.getElementById('source-cards').innerHTML=allSources.map(function(s){
    var active=s.status==='active'||s.is_active;
    var dotColor=active?'var(--green)':'var(--red)';
    var statusText=active?'Active':'Inactive';
    return '<div class="card source-card"><div class="src-name"><span class="source-dot" style="background:'+dotColor+'"></span>'+(s.source_name||s.name||s.data_source||'Unknown')+'</div><div class="src-status">Status: '+statusText+'</div><div style="margin-top:6px;font-size:12px;color:var(--muted)">'+(s.last_fetch?'Last fetch: '+new Date(s.last_fetch).toLocaleString():'')+'</div></div>';
  }).join('');
}

function setupTabs(){
  var tabs=document.querySelectorAll('.tab');
  for(var i=0;i<tabs.length;i++){
    tabs[i].addEventListener('click',function(){
      for(var j=0;j<tabs.length;j++) tabs[j].classList.remove('active');
      this.classList.add('active');
      var views=document.querySelectorAll('.view');
      for(var k=0;k<views.length;k++) views[k].classList.remove('active');
      var target=this.getAttribute('data-view');
      var viewEl=document.getElementById('view-'+target);
      if(viewEl) viewEl.classList.add('active');
    });
  }
}

function setupEventListeners(){
  document.getElementById('search-input').addEventListener('input',applyEventsFilter);
  document.getElementById('filter-cat').addEventListener('change',applyEventsFilter);
  document.getElementById('sort-evt-id').addEventListener('click',function(){sortEvtTable('event_id')});
  document.getElementById('sort-evt-prob').addEventListener('click',function(){sortEvtTable('probability')});
  document.getElementById('sort-evt-conf').addEventListener('click',function(){sortEvtTable('confidence')});
  document.getElementById('sort-cat-prob').addEventListener('click',function(){sortCatTable('probability')});
  document.getElementById('sort-cat-conf').addEventListener('click',function(){sortCatTable('confidence')});
}

setupTabs();
setupEventListeners();
fetchAll();
setInterval(fetchAll, 300000);
</script>
</body>
</html>
